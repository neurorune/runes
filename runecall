#!/usr/bin/env lua

local function realpath(cmd)
  local f = io.popen(cmd)
  local p = f:read("*l")
  f:close()
  return p
end

local function dirname(path)
  return path:match("(.*/)")
end

-- üîß FIX: derive runes root dynamically
local SELF = realpath("readlink -f " .. arg[0])
local RUNES_ROOT = dirname(SELF)

-- original language map (unchanged behavior)
local runes = {
  c          = RUNES_ROOT .. "C/.croc",
  cpp        = RUNES_ROOT .. "C++/.hydra",
  javascript = RUNES_ROOT .. "JavaScript/.bun",
  python     = RUNES_ROOT .. "Python/.waves",
  rust       = RUNES_ROOT .. "Rust/.ratatuya",
}

local lang = arg[1]

if not lang or not runes[lang] then
  print("‚ùå Unknown language\n")
  print("Available runes:")
  for k, _ in pairs(runes) do
    print("  ‚Ä¢ " .. k)
  end
  os.exit(1)
end

local src = runes[lang]

-- original behavior: copy hidden folder to cwd
local cmd = string.format('cp -r "%s" .', src)
local ok = os.execute(cmd)

if ok then
  local folder = src:match("(.*/)(%.[^/]+)$")
  print("ü™Ñ Summoned " .. (folder or "rune") .. " for " .. lang)
else
  print("üí• Failed to summon rune")
end
